

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basic usage &mdash; EDIpack2.0 beta 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=2a08395c" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f68cc3da"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Global variables" href="globvars.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            EDIpack2.0
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../fortran_src/edipack2.html">EDIpack 2.0</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="edipy2.html">EDIpy2: the Python API for EDIpack2</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="globvars.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="functions.html">Functions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EDIpack2.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="edipy2.html">EDIpy2: the Python API for EDIpack2</a></li>
      <li class="breadcrumb-item active">Basic usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python_api/basicusage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="basic-usage">
<h1>Basic usage<a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h1>
<p>The edipy2 module consists mainly of a class called <code class="code docutils literal notranslate"><span class="pre">global_env</span></code>. The global variables and the functions of the EDIpack2 library that are exposed to the user are methods of this class. The class needs to be imported at the beginning of the script, along with other useful modules. Numpy is necessary, while mpi4py is strongly recommended.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">edipy2</span> <span class="kn">import</span> <span class="n">global_env</span> <span class="k">as</span> <span class="n">ed</span>
<span class="kn">import</span> <span class="nn">mpi4py</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">sys</span>
</pre></div>
</div>
<p>An example driver is provided in the folder <code class="code docutils literal notranslate"><span class="pre">tests/python</span></code> of the EDIpack2 repo. The basic steps to follow to run a single loop of DMFT-ED with edipy2 are the following:</p>
<p>Read the input file</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">read_input</span><span class="p">(</span><span class="s2">&quot;inputED.conf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will read an input file or generate a template one if no such file is found. The template will have the <code class="code docutils literal notranslate"><span class="pre">used.</span></code> prefix, which will need to be removed. An <a class="reference external" href="https://raw.githubusercontent.com/aamaricci/EDIpack2.0/refs/heads/master/test/python/inputED.conf">example</a> of input file with a brief description of the relevant global variables is provided in the EDIpack2 repo.</p>
<p>Set the local Hamiltonian</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">set_hloc</span><span class="p">(</span><span class="n">hloc</span><span class="o">=</span><span class="n">Hloc</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="code docutils literal notranslate"><span class="pre">BATH_TYPE</span></code> is <code class="code docutils literal notranslate"><span class="pre">REPLICA</span></code> or <code class="code docutils literal notranslate"><span class="pre">GENERAL</span></code>, the replica matrix has to be initialized via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">set_hreplica</span><span class="p">(</span><span class="n">hvec</span><span class="p">,</span> <span class="n">lambdavec</span><span class="p">)</span>
<span class="n">ed</span><span class="o">.</span><span class="n">set_general</span><span class="p">(</span><span class="n">hvec</span><span class="p">,</span> <span class="n">lambdavec</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="code docutils literal notranslate"><span class="pre">hvec</span></code> and <code class="code docutils literal notranslate"><span class="pre">lambdavec</span></code> are arrays of the proper size (see function documentation).</p>
<p>The solver needs to be initialized via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">init_solver</span><span class="p">()</span>
</pre></div>
</div>
<p>Optionally, such as when real-space DMFT is used, the bath can be already allocated as an array, the dimension of which has to be given by the output of <code class="code docutils literal notranslate"><span class="pre">Nb</span></code> = <code class="xref py py-func docutils literal notranslate"><span class="pre">ed.get_bath_dimension()</span></code> for single-impurity DMFT and <code class="code docutils literal notranslate"><span class="pre">[Nlat,Nb]</span></code> for real-space DMFT, where <code class="code docutils literal notranslate"><span class="pre">Nlat</span></code> is the number of inequivalent impurities</p>
<p>The impurity problem is then solved via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">bath</span><span class="p">)</span>
</pre></div>
</div>
<p>The self-energy needs to be retrieved in order to calculate the local lattice Green’s function, via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">get_sigma</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The local Green’s function calculation is left to the user, as well as that of the Weiss field or the Delta function, to be fitted by the new bath.
This latter step happens via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bath</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">chi2_fitgf</span><span class="p">(</span><span class="n">Delta</span><span class="p">,</span><span class="n">bath</span><span class="p">,</span><span class="n">ispin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">iorb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>(check the function documentation for more details), but alternatively a fitting routine of the user’s choice can be employed.
Convergence can be checked via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">err</span><span class="p">,</span><span class="n">converged</span><span class="o">=</span><span class="n">ed</span><span class="o">.</span><span class="n">check_convergence</span><span class="p">(</span><span class="n">Delta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">ed</span><span class="o">.</span><span class="n">dmft_error</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ed</span><span class="o">.</span><span class="n">Nloop</span><span class="p">)</span>
</pre></div>
</div>
<p>and, finally, the solution environment can be cleaned up via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">finalize_solver</span><span class="p">()</span>
</pre></div>
</div>
<p>some or all of the steps above can be inserted in the DMFT convergence loop.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="globvars.html" class="btn btn-neutral float-right" title="Global variables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Lorenzo Crippa and Adriano Amaricci.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>